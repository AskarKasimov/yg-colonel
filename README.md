# Распределенный вычислитель арифметических выражений
Забегая вперёд, это репозиторий оркестратора, а репозиторий с агентом вот: https://github.com/AskarKasimov/yg-recruit

Связь со мной: [Telegram](https://t.me/a_s_k_a_rr), [прочее тут](https://askar.su)

## Архитектура
Система работает по системе поллинга.

Агенты (коих я назвал **Recruit**) с определенным интервалом посылают GET-запросы Оркестратору (коего я назвал **Colonel**).
Colonel имеет связь с базой данных на PostgreSQL (поля продемонстрированы на картинке ниже).

Названия полей базы прямо отражают их суть.

p.s. поле *progress* в таблице *Expressions* имеет три возможных состояния: done, processing и waiting, соотвественно, когда выражение обработано, когда в процессе счета, когда ожидает своей очереди на исполнение.

При включении Recruit *регистрируется* у оркестратора, получая свой ID в обмен на *Имя*. Имя – своеобразный идентификатор, лежащий на отвественности того, кто распоряжается агентами. **В переменной окружения необходимо менять Имя для каждого экземпляра.**

При отправке запроса на получение выражения для его счёта сервер обновляет состояние *isAlive* Recruit'а.

С определенным временным интервалом Colonel также проходится по Recruit'ам, обновляя их состояние согласно последнему *Heartbeat'у*. Если выясняется, что какой-то из агентов не выходил на связь в последнее врем, его выражения снова переходят в статус ожидающих решения и в ближайшее время снова найдут своего решателя)

![Иллюстрация](https://github.com/AskarKasimov/yg-colonel/blob/master/scheme.drawio.png)

## Счёт

Получая выражение, Recruit использует библиотеку для вычисления, а затем *спит* определенное время в соответствии с заданной сложностью арифметических операций (в переменных окружения в минутах).

## Запуск

Используем Docker Compose из корневой директории этого репозитория:
```
docker-compose up --build
```
Далее скачиваем [репозиторий Recruit](https://github.com/AskarKasimov/yg-recruit) и тоже запускаем его с помощью Docker Compose:
```
docker-compose up --build
```
При желании можно не уделять отдельное внимание настройке переменных окружения, ведь они изначально неплохо подготовлены)

p.s. описаны они в docker-compose.yaml

Подготовлен Frontend на http://localhost:8080, а также есть и Swagger на http://localhost:8080/swagger/index.html
